---
title: "Customized Visualization functions in SigFun"
package: SigFun
output:
  BiocStyle::html_document:
    toc: true
    toc_depth: 3
    number_sections: true
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{QuickStart}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r style, echo=FALSE, results='asis'}
BiocStyle::markdown(css.files = c('custom.css'))
knitr::opts_chunk$set(collapse=TRUE, comment="#>")
```

# Introduction
SigFun provides several visualization functions for users to inspect the results 
of the analysis. In addition to the integrative heatmap, `plot_heat`, as 
demonstrated in the Quick Start page, a total of 11 other methods can be applied 
to visualize the results from different perspectives.

**SigFun provides users with the flexibility to visualize their own pre-computed 
Gene Set Enrichment Analysis (GSEA) results**, independent of the platform's 
integrated analysis workflow. 
For compatibility, **SigFun only supports the import of result objects generated 
by the clusterProfiler::GSEA function.**

1. **[plot_heat](#plot_heat)** – Visualizes analysis results with an integrative 
heatmap.
2. **[barPlot](#barPlot)** – Visualizes analysis results with a bar plot.
3. **[chordPlot](#chordPlot)** – Visualizes analysis results with a chord plot.
4. **[cnetPlot](#cnetPlot)** – Visualizes analysis results with a concept 
network.
5. **[dotPlot](#dotPlot)** – Visualizes analysis results with a dot plot.
6. **[emapPlot](#emapPlot)** – Visualizes analysis results with a enrichment map 
plot.
7. **[gseaPlot](#gseaPlot)** – Visualizes analysis results with a enrichment 
score plot.
8. **[heatPlot](#heatPlot)** – Visualizes analysis results with a heat plot.
9. **[lollipopPlot](#lollipopPlot)** – Visualizes analysis results with a 
lollipop plot.
10. **[ridgePlot](#ridgePlot)** – Visualizes analysis results with a ridge plot.
11. **[treePlot](#treePlot)** – Visualizes analysis results with a tree plot.
12. **[upsetPlot](#upsetPlot)** – Visualizes analysis results with a UpSet plot.

# Visualization functions in SigFun
## Loading the demo input object and run SigFun.
We can use the build-in one-click function sig2Fun or use totally customized 
GSEA results by modified the `cor.df` and 

```{r customized_log2FC, warning=FALSE}
library(SigFun)
library(dplyr)

#Loading an example SummarizedExperiment object.
data(demo_GSE181574)
GSE181574.sigfun <- SummarizedExperiment::SummarizedExperiment(
assays=list(abundance=as.matrix(expr.data)),
rowData=S4Vectors::DataFrame(mapping, row.names=mapping$ensg_id),
colData=SIG_MAT)

# Method 1 (recommended): Use the build-in function sig2Fun
GSE181574.sigfun.res <- sig2Fun(GSE181574.sigfun,
    cor.method = "logit", 
    t2g = t2g, # the ontology dataset
    strings=c("GOBP","GOCC","GOMF","KEGG", 
            "REACTOME","WP","HALLMARK","SIGNALING"))

# Method 2:  Use your own GSEA results by modifying the cor.df and gseaResult
# Run GSEA using clusterProfiler
# Just replace these variables with your own analysis results
geneList <- GSE181574.sigfun.res@metadata$cor.df["cor"] %>% unlist()
names(geneList) <- GSE181574.sigfun.res@metadata$cor.df$gene
geneList <- sort(geneList, decreasing = TRUE)

# Use clusterProfiler::GSEA function 
# Change TERM2GENE to customized your own ontology database
clusterProfiler <- clusterProfiler::GSEA(geneList, TERM2GENE = t2g)

# Add the GSEA result to the metadata of your object
SE_data <- SummarizedExperiment::SummarizedExperiment(
    assays=list(abundance=as.matrix(expr.data)),
    rowData=S4Vectors::DataFrame(mapping, row.names=mapping$ensg_id),
    colData=S4Vectors::DataFrame(SIG_MAT))

S4Vectors::metadata(GSE181574.sigfun.res) <- list(
    gseaResult=clusterProfiler,
    cor.df=S4Vectors::metadata(GSE181574.sigfun.res)$cor.df)

```

## Plot an inntegrative heatmap {#plot_heat}
To use `plot_heat` function, we have to transform the `t2g` dataframe to a list 
format first. Then we can use `plot_heat` to generate a integrative heatmap.
```{r transform, warning=FALSE}
# Transform t2g (data.frame) to a list form
pathway.name <- unique(t2g$gs_name)
pathways.all <- lapply(pathway.name, function(x){
    res <- t2g %>% dplyr::filter(gs_name==x) %>%
    dplyr::select(ensembl_gene) %>%
    dplyr::pull()
    return(res)
})
names(pathways.all) <- pathway.name
```

** Several arguments is important to customized your visualization
    * topN: How many top functions you would like to show (defulr: 10).
    * ranking.method: Ranking metric used in GSEA. It Should be appeared in the 
    cor.df (default: "cor")
    * significant_type: Significance metric for filtering. Values larger than 
    0.05 will be omitted. It Should be appeared in the cor.df (default: "pval")
    * strings: Pathway categories to visualize. (e.g. "HALLMARK", "KEGG")

```{r plot_heat, warning=FALSE}
# Use plot_heat to generate a integrative heatmap
HALLMARK.plot <- plot_heat(
    SE_data.fgsea=GSE181574.sigfun.res,
    pathways.all=pathways.all,
    significant_type="pval", # the column name in cor.df
    strings=c("HALLMARK"),
    topN=10, 
    ranking.method="cor")  # the column name in cor.df

HALLMARK.plot$HALLMARK
```

** Signaling pathway is one of important functions which correlates to the 
signaltransduction mechanisms in perspectives of cellular activity. 
`SigFun` provides a special way to use strings. For example, if we want to know 
all functions with "SIGNALING" pattern, just specify `strings=c("SIGNALING")`, 
then all functions with SIGNALING pattern will be visualized in the integrative 
heatmap. 

```{r plot_heat_signaling, warning=FALSE}
# Use plot_heat to generate a integrative heatmap
SIGNALING.plot <- plot_heat(
    SE_data.fgsea=GSE181574.sigfun.res,
    pathways.all=pathways.all,
    significant_type="pval", # the column name in cor.df
    strings=c("SIGNALING"),
    topN=10, 
    ranking.method="cor")  # the column name in cor.df

SIGNALING.plot$SIGNALING
```

## Plot a bar plot {#barPlot}
To depict a bar plot, the `barPlot` function will be used.
It displays the gene count for each pathway on the x-axis and pathway names on 
the y-axis, with bars colored by statistical significance measures or enrichment scores.

** Several arguments is important to customized your visualization
    * topN: How many top functions you would like to show (defult=10).
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=30).
    * alpha: A character string specifying which statistical measure to use
    for bar coloring transparency. Must be one of 'pvalue', 'p.adjust', 'NES'.
    (default="pvalue")

```{r plot_bar, warning=FALSE}
# Use barPlot to generate a bar plot.
library(ggplot2)
res.barplot <- barPlot(SE_data.fgsea=GSE181574.sigfun.res,
        topN=10,
        breaklineN=30,
        alpha="pvalue")

res.barplot$barPlot

# data can be found in $Table_barPlot
```















## Plot a chord diagram {#chordPlot}
To depict a chord diagram, the `chordPlot` function will be used.
It display the relationships between genes and their associated pathways from 
GSEA results. The chord plot provides an intuitive way to visualize gene-pathway 
associations, where genes and pathways are represented as nodes around a circle, 
connected by arcs that represent their relationships.

** Several arguments is important to customized your visualization
    * fontSize: A numeric value between 0 and 1 controlling the font size in 
    the chord plot. Values closer to 1 result in larger text (default=0.5).
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=30).
    * showCategory: Either a numeric value specifying the number of top 
    pathways to display, or a character vector of specific pathway names to 
    include in the visualization (default=5).

```{r chordPlot, warning=FALSE}
res.chord <- chordPlot(SE_data.fgsea=GSE181574.sigfun.res,
        fontSize=0.5,
        breaklineN=30,
        showCategory=2)

res.chord$chordPlot
# data can be found in $Table_chordPlot

```

## Plot a concept network {#cnetPlot}
To depict a concept network, the `cnetPlot` function will be used.
The network displays connections between enriched pathways and their associated 
genes, with optional color coding based on gene expression correlation values. 
This visualization helps identify hub genes that participate in multiple 
biological pathways and reveals the interconnected structure of enriched gene 
sets.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value indicating the number of top
    pathways to display, or a character vector specifying particular pathway
    names to show. (defult=5)
    * node_label: Character string specifying node label type. One of 'all', 
    'none', 'category' (default), 'item', 'exclusive' or 'share'.
    * fontSize: Numeric value controlling category label font size in the
    network. (defult=1.2)
    * color: Logical indicating whether to color-code genes by their 
    correlation values. (defult=TRUE)
    * dotColor: A character string specifying which column from the
    correlation data frame to use for dot color. (defult="cor")
    * circular: Logical indicating whether to use circular layout
    or automatic nice layout. (default=FALSE)

```{r cnetPlot, warning=FALSE}
res.cne <- cnetPlot(SE_data.fgsea=GSE181574.sigfun.res,
    showCategory=5, 
    node_label='category',
    fontSize=1.2, 
    color=TRUE, 
    dotColor='cor', 
    circular=FALSE, 
    breaklineN=30
    )
res.cne$cnetPlot
# data can be found in $TableEdge_cnetPlot and $TableNode_cnetPlot
```

## Plot a dot plot {#dotPlot}
To depict a dot plot, the `dotPlot` function will be used.
It displays enriched gene sets with customizable visual encoding for statistical 
significance and enrichment scores.

** Several arguments is important to customized your visualization
    * color: A character vector specifying which variable to use for color
    encoding. Must be one of "pvalue", "p.adjust", or "NES" (Normalized
    Enrichment Score). Default is c('pvalue','p.adjust','NES').
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=20).
    * showCategory: Either a numeric value specifying the number of top 
    pathways to display, or a character vector of specific pathway names to 
    include in the visualization (default=10).

```{r dotPlot, warning=FALSE}
res.dot <- dotPlot(SE_data.fgsea=GSE181574.sigfun.res,
        showCategory=10,
        breaklineN=20,
        color='pvalue')

res.dot$dotPlot
# data can be found in Table_dotPlot
```

## Plot a enrichment map {#emapPlot}
To depict a enrichment map, the `emapPlot` function will be used.
The enrichment map provides an intuitive overview of the functional landscape 
by clustering related biological processes and highlighting pathway 
relationships through shared genes.
This network-based visualization displays pathways as nodes and connects 
similar pathways with edges, where edge thickness represents the degree of 
similarity between pathways.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value specifying the number of top 
    pathways to display, or a character vector of specific pathway names to 
    include in the visualization (default=10).

```{r emapPlot, warning=FALSE}
res.ema <- emapPlot(SE_data.fgsea=GSE181574.sigfun.res,
        showCategory=10)

res.ema$emapPlot
# data can be found in $Table_emapPlot
```

## Plot an enrichment score plot {#gseaPlot}
To depict an enrichment score plot, the `gseaPlot` function will be used.
It displays the running enrichment score, gene positions, and statistical 
information for selected gene sets, providing a comprehensive view of how genes 
within a pathway contribute to the enrichment signal.
This function serves as a wrapper around `enrichplot::gseaplot2` to simplify 
the process of generating enrichment score plots.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value specifying the number of top 
    pathways to display, or a character vector of specific pathway names to 
    include in the visualization (default=10).


```{r gseaPlot, warning=FALSE}
gseaPlot(SE_data.fgsea=GSE181574.sigfun.res,
        showCategory=5)

```

## Plot a simple heat plot {#heatPlot}
To depict a bar plot, the `barPlot` function will be used.
It displays genes on the x-axis and pathways on the y-axis, with dots colored 
by correlation coefficients and sized by statistical significance measures.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value indicating the number of top
    pathways to display, or a character vector specifying particular pathway 
    names to show. (defult=5).
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=30).
    * dotColor: A character string specifying which column from the 
    correlation data frame (cor.df) to use for dot color.
    * dotSize: A character string specifying which column from the 
    correlation data frame to use for dot sizing. 
    Must be one of 'pval' (default) or 'p.adjust'.
    For more arguments, please refer to the manual of heatPlot.
    
```{r heatPlot, warning=FALSE}
res.heat <- heatPlot(SE_data.fgsea=GSE181574.sigfun.res,
        breaklineN=30, 
        showCategory=2, 
        dotSize='pval', 
        dotColor='cor')

res.heat$heatPlot
# data can be found in $table_heatPlot
```

## Plot a lollipop plot{#lollipopPlot}
To depict pathways as horizontal bars with dots at the end, where the position 
of each dot represents the Normalized Enrichment Score (NES) and additional 
visual elements indicate statistical significance. The plot provides an 
intuitive way to compare pathway enrichment across multiple biological 
processes, with pathways ordered by their enrichment scores.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value indicating the number of top
    pathways to display, or a character vector specifying particular pathway
    names to show. (defult=10).
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=30).


```{r lollipopPlot, warning=FALSE}
# Use lollipop to generate a bar plot.
res.lollipop <- lollipopPlot(SE_data.fgsea=GSE181574.sigfun.res,
        showCategory=10,
        breaklineN=30)

res.lollipop$lollipopPlot
# data can be found in $Table_lollipopPlot
```

## Plot a ridge plot {#ridgePlot}
To depict a ridge plot, the `ridgePlot` function will be used.
It displays the distribution of gene expression values for each gene set as 
overlapping density curves, providing an intuitive way to visualize and compare 
the enrichment patterns across multiple pathways. Each ridge represents a gene 
set, with the curve shape indicating the distribution of genes within that 
pathway along the ranked gene list.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value indicating the number of top
    pathways to display, or a character vector specifying particular pathway
    names to show. (defult=10).
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=30).

```{r ridgePlot, warning=FALSE}
res.ridge <- ridgePlot(SE_data.fgsea=GSE181574.sigfun.res,
        showCategory=10,
        breaklineN=30)

res.ridge$ridgePlot
# data can be found in $Table_ridgePlot
```

## Plot a hierarchical tree plot {#treePlot}
The tree plot groups similar pathways together based on their gene overlap and 
displays them in a dendrogram structure, providing an intuitive way to 
understand pathway relationships and identify functional clusters. The plot uses 
color coding to represent statistical significance or other enrichment metrics.

** Several arguments is important to customized your visualization
    * showCategory: An integer specifying the number of top pathways to
    display in the tree plot. The pathways are typically ranked by significance
    or enrichment score. (default=10).
    * color: A character string specifying which column from the GSEA results
    to use for color mapping. Options are 'pvalue', 'p.adjust', 'qvalue', 'NES' 
    (default="pvalue")
    For more arguments, please refer to the manual of `treePlot`.

```{r treePlot, warning=FALSE}
res.tree <- treePlot(SE_data.fgsea=GSE181574.sigfun.res,
         showCategory=10, 
         color='pvalue')

res.tree$treePlot
# data can be found in res.tree$Table_treePlot
```

## Plot a UpSet plot {#upsetPlot}
To depict a UpSet plot, the `upsetPlot` function will be used.
It visualize overlapping genes across multiple pathways from GSEA results.
The plot consists of two panels: 
    * a boxplot showing the distribution of correlation coefficients for each 
    pathway combination
    * an intersection matrix showing which pathways contribute to each 
    combination.

** Several arguments is important to customized your visualization
    * showCategory: Either a numeric value indicating the number of top
    pathways to display, or a character vector specifying particular pathway
    names to show (defult=5).
    * breaklineN: An integer specifying the number of characters after which
    to break pathway names into multiple lines for better readability on the
    y-axis (default=30).
    * type: A character string specifying the type of plot to display in the
    upper panel. Must be one of "bar" or "box" (default). 

```{r upsetPlot, warning=FALSE}
res.upsetPlot <- upsetPlot(SE_data.fgsea=GSE181574.sigfun.res,
        showCategory=5,
        breaklineN=30,
        type="box")

res.upsetPlot$upsetPlot
# data can be found in $Table_upsetPlot
```

# Session info
```{r sessionInfo, echo=FALSE}
sessionInfo()
```
